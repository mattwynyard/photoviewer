(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{65:function(e,t,a){e.exports=a(82)},72:function(e,t,a){},74:function(e,t,a){},82:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),r=a(16),s=a.n(r),i=(a(70),a(71),a(72),a(12)),l=a.n(i),c=a(52),u=a(53),m=a(63),h=a(54),d=a(64),p=a(97),g=a(98),f=a(86),v=a(88),E=a(89),k=a(96),y=a(90),w=a(99),b=a(95),S=a(92),C=a(94),x=a(87),j=a(91),N=a(60),L=a(93),z=a(9),A=a.n(z),I=(a(74),a(21)),P=a.n(I),D=function(e){function t(e){var a;Object(c.a)(this,t),(a=Object(m.a)(this,Object(h.a)(t).call(this,e))).callBackendAPI=function(){var e,t;return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.a.awrap(fetch("http://osmium.nz/api"));case 2:return e=a.sent,a.next=5,l.a.awrap(e.json());case 5:if(t=a.sent,console.log(t.express),200===e.status){a.next=9;break}throw Error(t.message);case 9:return a.abrupt("return",t);case 10:case"end":return a.stop()}}))};var n=a.getUser(),o=a.getLoginModal(n),r=a.getProjects();return a.state={location:{lat:-41.2728,lng:173.2995},token:P.a.get("token"),login:n,loginModal:o,zIndex:900,osmThumbnail:"satellite64.png",mode:"map",zoom:8,index:null,markersData:[],centreData:[],objData:[],fault:[],priority:[],sizes:[],photos:[],currentPhoto:null,currentFault:[],layers:[],bounds:{},icon:a.getCustomIcon(),show:!1,showLogin:!1,showContact:!1,showTerms:!1,showAbout:!1,modalPhoto:null,popover:!1,photourl:null,amazon:"https:/taranaki.s3.ap-southeast-2.amazonaws.com/Roads/2019_11/",user:null,passowrd:null,projectArr:r},a}return Object(d.a)(t,e),Object(u.a)(t,[{key:"getProjects",value:function(){var e=P.a.get("projects");return void 0===e?[]:JSON.parse(e)}},{key:"getUser",value:function(){var e=P.a.get("user");return void 0===e?"Login":e}},{key:"getLoginModal",value:function(e){var t=this;return"Login"===e?function(e){return t.clickLogin(e)}:function(e){return t.logout(e)}}},{key:"getCustomIcon",value:function(e,t){var a=this.getSize(t);return"5"===e?A.a.icon({iconUrl:"CameraSpringGreen_16px.png",iconSize:[a,a],iconAnchor:[a/2,a/2]}):"4"===e?A.a.icon({iconUrl:"CameraOrange_16px.png",iconSize:[a,a],iconAnchor:[a/2,a/2]}):"3"===e?A.a.icon({iconUrl:"CameraLemon_16px.png",iconSize:[a,a],iconAnchor:[a/2,a/2]}):A.a.icon({iconUrl:"CameraSpringGreen_16px.png",iconSize:[a,a],iconAnchor:[a/2,a/2]})}},{key:"getSize",value:function(e){return e<10?4:e>=10&&e<=14?10:e>14&&e<=16?16:e>16&&e<=18?20:32}},{key:"componentDidMount",value:function(){this.callBackendAPI().catch((function(e){return console.log(e)})),this.map=this.map.leafletElement}},{key:"componentDidUpdate",value:function(){}},{key:"addMarkers",value:function(e){var t,a,n,o,r,s,i,c,u,m,h;return l.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:for(t=[],a=[],n=[],o=[],r=[],[],s=0;s<e.length;s++)({}),i={gid:e[s].gid,roadid:e[s].roadid,carriage:e[s].carriagewa,location:e[s].location,fault:e[s].fault,size:e[s].size,priority:e[s].priority,photo:e[s].photoid,datetime:e[s].faulttime},n.push(e[s].fault),o.push(e[s].photoid),a.push(i),r.push(e[s].priority),c=JSON.parse(e[s].st_asgeojson),u=c.coordinates[0],m=c.coordinates[1],h=A.a.latLng(m,u),t.push(h);this.setState({objData:a}),this.setState({markersData:t});case 9:case"end":return l.stop()}}),null,this)}},{key:"addCentrelines",value:function(e){var t=[];console.log(e.length);for(var a=0;a<e.length;a++){var n=JSON.parse(e[a].st_asgeojson);if(null!==n)for(var o=[],r=n.coordinates[0],s=0;s<r.length;s++){var i=r[s],l=A.a.latLng(i[1],i[0]);o.push(l)}t.push(o)}console.log(t),this.setState({centreData:t})}},{key:"pad",value:function(e,t,a){return a=a||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(a)+e}},{key:"onZoom",value:function(e){this.setState({zoom:e.target.getZoom()}),this.setState({bounds:e.target.getBounds()})}},{key:"toogleMap",value:function(e){"map"===this.state.mode?(this.setState({zIndex:1e3}),this.setState({mode:"sat"}),this.setState({osmThumbnail:"map64.png"})):(this.setState({zIndex:900}),this.setState({mode:"map"}),this.setState({osmThumbnail:"satellite64.png"}))}},{key:"clickImage",value:function(e){console.log("click imge"),this.setState({show:!0});var t=this.getFault(this.state.index,"photo");this.setState({currentPhoto:t})}},{key:"getPhoto",value:function(e){var t=this.state.currentPhoto,a=parseInt(t.slice(t.length-5,t.length)),n=null;n="prev"===e?a-1:a+1;var o=this.pad(n,5),r=t.slice(0,t.length-5)+o;return this.setState({currentPhoto:r}),r}},{key:"clickPrev",value:function(e){var t=this.getPhoto("prev");console.log(t),this.setState({currentPhoto:t});var a=this.state.amazon+t+".jpg";this.setState({photourl:a})}},{key:"clickNext",value:function(e){var t=this.getPhoto("next");this.setState({currentPhoto:t});var a=this.state.amazon+t+".jpg";this.setState({photourl:a})}},{key:"clickMarker",value:function(e){var t=e.target.options.index;this.setState({index:t}),this.setState({popover:!0})}},{key:"logout",value:function(e){var t,a,n=this;return l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(this.state.login),e.next=3,l.a.awrap(fetch("http://osmium.nz/logout",{method:"POST",credentials:"same-origin",headers:{authorization:this.state.token,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({user:this.state.login})}));case 3:return t=e.sent,e.next=6,l.a.awrap(t.json());case 6:if(a=e.sent,200===t.status){e.next=9;break}throw Error(a.message);case 9:console.log(a.success),this.setState({login:"Login"}),this.setState({loginModal:function(e){return n.clickLogin(e)}}),P.a.remove("token"),P.a.remove("user"),P.a.remove("projects"),this.setState({projectArr:[]}),console.log("ProjectArr: "+this.state.projectArr),this.render();case 18:case"end":return e.stop()}}),null,this)}},{key:"login",value:function(e){var t,a,n=this;return l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({showLogin:!1}),e.next=3,l.a.awrap(fetch("http://osmium.nz/login",{method:"POST",credentials:"same-origin",headers:{authorization:this.state.token,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({user:this.userInput.value,key:this.passwordInput.value})}));case 3:return t=e.sent,e.next=6,l.a.awrap(t.json());case 6:if(a=e.sent,200===t.status){e.next=9;break}throw Error(a.message);case 9:a.result?(console.log("Login succeded"),P.a.set("token",a.token,{expires:7}),P.a.set("user",a.user,{expires:7}),this.setState({login:a.user}),this.setState({token:a.token}),this.setState({loginModal:function(e){return n.logout(e)}}),this.buildProjects(a.projects)):console.log("Login failed");case 10:case"end":return e.stop()}}),null,this)}},{key:"buildProjects",value:function(e){for(var t=[],a=0;a<e.length;a+=1)t.push(e[a].description+" "+e[a].date);P.a.set("projects",JSON.stringify(t),{expires:7}),this.setState({projectArr:t})}},{key:"loadLayer",value:function(e){var t,a;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log("token: "+this.state.token),"Login"===this.state.login){n.next=13;break}return n.next=4,l.a.awrap(fetch("http://osmium.nz/layer",{method:"POST",headers:{authorization:this.state.token,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({latitude:this.state.location.lat,longitude:this.state.location.lng,menu:e.target.id,user:this.state.login})}));case 4:return 200!==(t=n.sent).status&&console.log(t.status),n.next=8,l.a.awrap(t.json());case 8:return a=n.sent,n.next=11,l.a.awrap(this.addMarkers(a));case 11:n.next=13;break;case 13:case"end":return n.stop()}}),null,this)}},{key:"loadCentreline",value:function(e){var t,a;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(console.log(e.target.title),"Login"===this.state.login){n.next=13;break}return n.next=4,l.a.awrap(fetch("http://osmium.nz/roads",{method:"POST",headers:{authorization:this.state.token,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({code:"900",menu:e.target.id,user:this.state.login})}));case 4:return 200!==(t=n.sent).status&&console.log(t.status),n.next=8,l.a.awrap(t.json());case 8:return a=n.sent,n.next=11,l.a.awrap(this.addCentrelines(a));case 11:n.next=13;break;case 13:case"end":return n.stop()}}),null,this)}},{key:"clickLogin",value:function(e){this.setState({showLogin:!0})}},{key:"clickAbout",value:function(e){this.setState({showAbout:!0})}},{key:"clickTerms",value:function(e){this.setState({showTerms:!0})}},{key:"clickContact",value:function(e){this.setState({showContact:!0})}},{key:"clickClose",value:function(e){this.setState({showContact:!1}),this.setState({showAbout:!1}),this.setState({showTerms:!1})}},{key:"closeModal",value:function(){this.setState({show:!1}),this.setState({popover:!1})}},{key:"getColor",value:function(){return"#"+Math.random().toString(16).substr(-6)}},{key:"getFault",value:function(e,t){if(0===this.state.objData.length||null===e)return null;switch(t){case"fault":return this.state.objData[e].fault;case"priority":return this.state.objData[e].priority;case"location":return this.state.objData[e].location;case"size":return this.state.objData[e].size;case"datetime":return this.state.objData[e].datetime;case"photo":return this.state.objData[e].photo;default:return null}}},{key:"render",value:function(){var e=this;console.log("render");var t=[this.state.location.lat,this.state.location.lng],a=(this.state.centreData,this.state.markersData.markersData,this.state.fault.fault),n=this.state.photos.photo;return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null,o.a.createElement(C.a,{bg:"light",expand:"lg"},o.a.createElement(C.a.Brand,{href:"#home"},o.a.createElement("img",{src:"logo.png",width:"122",height:"58",className:"d-inline-block align-top"})),o.a.createElement(b.a,null,o.a.createElement(S.a,{className:"navdropdown",title:"Layers",id:"basic-nav-dropdown"},o.a.createElement((function(e){var t=e.projects,a=e.onClick;return void 0===t?(console.log("Projects"+t),o.a.createElement(S.a.Item,{title:" Add Layers",className:"dropdownitem"},"Add Layers")):0===t.length?o.a.createElement(S.a.Item,{title:" Add Layers",className:"dropdownitem"},"Add Layers"):o.a.createElement(S.a,{title:" Add Layers",className:"navdropdownitem",drop:"right"},e.projects.map((function(e,t){return o.a.createElement(S.a.Item,{className:"navdropdownitem",key:"".concat(t),index:t,title:e,onClick:function(e){return a(e)}},e)})),o.a.createElement(S.a.Divider,null))}),{projects:this.state.projectArr,onClick:function(t){return e.loadLayer(t)}}),o.a.createElement(S.a.Divider,null),o.a.createElement(S.a.Item,{className:"navdropdownitem",href:"#action/3.4",onClick:function(t){return e.loadCentreline(t)}},"Add centreline "),o.a.createElement(S.a.Divider,null),o.a.createElement(S.a.Item,{className:"navdropdownitem",href:"#action/3.4"},"Remove layer"))),o.a.createElement(b.a,null,o.a.createElement(S.a,{className:"navdropdown",title:"Help",id:"basic-nav-dropdown"},o.a.createElement(S.a.Item,{className:"navdropdownitem",href:"#terms",onClick:function(t){return e.clickTerms(t)}},"Terms of Use"),o.a.createElement(S.a.Divider,null),o.a.createElement(S.a.Item,{className:"navdropdownitem",href:"#contact",onClick:function(t){return e.clickContact(t)}},"Contact"),o.a.createElement(S.a.Divider,null),o.a.createElement(S.a.Item,{className:"navdropdownitem",id:"Documentation",href:"#documentation",onClick:function(t){return e.documentation(t)}},"Documentation"),o.a.createElement(S.a.Divider,null),o.a.createElement(S.a.Item,{className:"navdropdownitem",href:"#about",onClick:function(t){return e.clickAbout(t)}},"About"))),o.a.createElement((function(e){return"Login"===e.title?o.a.createElement(b.a,{className:"ml-auto"},o.a.createElement(b.a.Link,{id:"Login",href:"#login",onClick:e.onClick},e.title," ")):o.a.createElement(b.a,{className:"ml-auto"},o.a.createElement(S.a,{className:"navdropdown",title:e.title,id:"basic-nav-dropdown"},o.a.createElement(S.a.Item,{className:"navdropdownitem",href:"#contact",onClick:e.onClick},"Logout")))}),{className:"navdropdown",title:this.state.login,onClick:this.state.loginModal}))),o.a.createElement("div",{className:"map"},o.a.createElement(g.a,{ref:function(t){e.map=t},className:"map",fault:a,photo:n,worldCopyJump:!0,boxZoom:!0,center:t,zoom:this.state.zoom,onZoom:function(t){return e.onZoom(t)}},o.a.createElement(p.a,{className:"mapLayer",attribution:'&copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors and Chat location by Iconika from the Noun Project',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",zIndex:999}),o.a.createElement(f.a,null),o.a.createElement(x.a,{className:"satellite",src:this.state.osmThumbnail,onClick:function(t){return e.toogleMap(t)},thumbnail:!0}),o.a.createElement(v.a,{position:"topright"},o.a.createElement(v.a.Overlay,{checked:!0,name:"state highway"},o.a.createElement(E.a,null,this.state.centreData.map((function(t,a){return o.a.createElement(k.a,{key:"".concat(a),weight:3,color:e.getColor(),smoothFactor:3,positions:t})})))),o.a.createElement(v.a.Overlay,{checked:!0,name:"first layer"},o.a.createElement(E.a,null,this.state.markersData.map((function(t,r){return o.a.createElement(y.a,{key:"".concat(r),index:r,data:a,photo:n,position:t,icon:e.getCustomIcon(e.getFault(r,"priority"),e.state.zoom),draggable:!1,onClick:function(t){return e.clickMarker(t)}},o.a.createElement(w.a,{className:"popup"},o.a.createElement("div",null,o.a.createElement("p",{className:"faulttext"},o.a.createElement("b",null,"Type: ")," ",e.getFault(r,"fault")," ",o.a.createElement("br",null)," ",o.a.createElement("b",null,"Priority: "," ")," ",e.getFault(r,"priority")," ",o.a.createElement("br",null),o.a.createElement("b",null,"Location: "," ")," ",e.getFault(r,"location")),o.a.createElement("div",null,o.a.createElement(x.a,{className:"thumbnail",src:e.state.amazon+e.getFault(r,"photo")+".jpg",photo:n,onClick:function(t){return e.clickImage(t)},thumbnail:!0})))))}))))))),o.a.createElement(j.a,{className:"termsModal",show:this.state.showTerms,size:"md",centered:!0},o.a.createElement(j.a.Header,null,o.a.createElement(j.a.Title,null,o.a.createElement("h2",null,"Road Inspection Viewer"))),o.a.createElement(j.a.Body,null,"By using this software you confirm you have read and agreed to the Onsite Developments Ltd. ",o.a.createElement("a",{href:"https://osmium.nz/?#terms"}," Click for terms of use."),o.a.createElement("br",null),"All data on this site from Land Information New Zealand is made available under a Creative Commons Attribution Licence.",o.a.createElement("br",null),o.a.createElement("span",null,"\xa9 2019 Onsite Developments Ltd. All rights reserved."),o.a.createElement("br",null)),o.a.createElement(j.a.Footer,null,o.a.createElement(N.a,{variant:"primary",type:"submit",onClick:function(t){return e.clickClose(t)}},"Close"))),o.a.createElement(j.a,{className:"aboutModal",show:this.state.showAbout,size:"md",centered:!0},o.a.createElement(j.a.Header,null,o.a.createElement(j.a.Title,null,o.a.createElement("h2",null,"About")," ")),o.a.createElement(j.a.Body,null,o.a.createElement("b",null,"Road Inspection Version 1.0"),o.a.createElement("br",null),"Relased: 12/01/2020",o.a.createElement("br",null),"Company: Onsite Developments Ltd.",o.a.createElement("br",null),"Software Developer: Matt Wynyard ",o.a.createElement("br",null),o.a.createElement("img",{src:"logo192.png",width:"24",height:"24"})," React: 16.12.0",o.a.createElement("br",null),o.a.createElement("img",{src:"bootstrap.png",width:"24",height:"24"})," Bootstrap: 4.4.0",o.a.createElement("br",null),o.a.createElement("img",{src:"leafletlogo.png",width:"60",height:"16"}),"Leaflet: 1.6.0",o.a.createElement("br",null),o.a.createElement("img",{src:"reactbootstrap.png",width:"24",height:"24"}),"React-bootstrap: 1.0.0-beta.16",o.a.createElement("br",null),"React-leaflet: 2.6.0",o.a.createElement("br",null)),o.a.createElement(j.a.Footer,null,o.a.createElement(N.a,{variant:"primary",size:"sm",type:"submit",onClick:function(t){return e.clickClose(t)}},"Close"))),o.a.createElement(j.a,{show:this.state.showLogin,size:"sm",centered:!0},o.a.createElement(j.a.Header,null,o.a.createElement(j.a.Title,null,o.a.createElement("img",{src:"padlock.png",width:"42",height:"42"})," Login ")),o.a.createElement(j.a.Body,null,o.a.createElement(L.a,null,o.a.createElement(L.a.Group,{controlId:"userName"},o.a.createElement(L.a.Label,null,"Username"),o.a.createElement(L.a.Control,{type:"text",placeholder:"Enter username",ref:function(t){return e.userInput=t}})),o.a.createElement(L.a.Group,{controlId:"formBasicPassword"},o.a.createElement(L.a.Label,null,"Password"),o.a.createElement(L.a.Control,{type:"password",placeholder:"Password",ref:function(t){return e.passwordInput=t}})),o.a.createElement(N.a,{variant:"primary",type:"submit",onClick:function(t){return e.login(t)}},"Submit"))),o.a.createElement(j.a.Footer,null)),o.a.createElement(j.a,{show:this.state.show,size:"xl"},o.a.createElement(j.a.Body,{className:"photoBody"},o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-md-6"},o.a.createElement("b",null,"Type: ")," ",this.getFault(this.state.index,"fault")," ",o.a.createElement("br",null)," ",o.a.createElement("b",null,"Priority: "," ")," ",this.getFault(this.state.index,"priority")," ",o.a.createElement("br",null),o.a.createElement("b",null,"Location: "," ")," ",this.getFault(this.state.index,"priority")),o.a.createElement("div",{className:"col-md-6"},o.a.createElement("b",null,"Size: ")," ",this.getFault(this.state.index,"size")," ",o.a.createElement("br",null)," ",o.a.createElement("b",null,"DateTime: "," ")," ",this.getFault(this.state.index,"datetime")))),o.a.createElement(x.a,{className:"photo",src:this.state.amazon+this.state.currentPhoto+".jpg",data:a,onClick:function(t){return e.clickImage(t)},thumbnail:!0})),o.a.createElement(j.a.Footer,null,o.a.createElement(N.a,{className:"prev",onClick:function(t){return e.clickPrev(t)}},"Previous"),o.a.createElement(N.a,{variant:"primary",onClick:function(){return e.setState({show:!1})}},"Close"),o.a.createElement(N.a,{className:"next",variant:"primary",onClick:function(t){return e.clickNext(t)}},"Next"))),o.a.createElement("div",{className:"footer"}))}}]),t}(o.a.Component),T=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function O(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}s.a.render(o.a.createElement(D,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");T?(!function(e,t){fetch(e).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):O(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):O(t,e)}))}}()}},[[65,1,2]]]);
//# sourceMappingURL=main.d93f3b89.chunk.js.map