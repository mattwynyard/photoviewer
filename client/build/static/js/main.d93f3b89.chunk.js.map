{"version":3,"sources":["App.js","serviceWorker.js","index.js"],"names":["App","props","callBackendAPI","a","async","fetch","response","json","body","console","log","express","status","Error","message","user","getUser","loginModal","getLoginModal","projects","getProjects","state","location","lat","lng","token","Cookies","get","login","zIndex","osmThumbnail","mode","zoom","index","markersData","centreData","objData","fault","priority","sizes","photos","currentPhoto","currentFault","layers","bounds","icon","getCustomIcon","show","showLogin","showContact","showTerms","showAbout","modalPhoto","popover","photourl","amazon","passowrd","projectArr","cookie","undefined","JSON","parse","e","clickLogin","logout","data","size","this","getSize","L","iconUrl","iconSize","iconAnchor","catch","err","map","leafletElement","faults","priorities","i","length","obj","gid","roadid","carriage","carriagewa","photo","photoid","datetime","faulttime","push","position","st_asgeojson","coordinates","latlng","latLng","setState","lineData","linestring","points","segment","j","point","n","width","z","Array","join","target","getZoom","getBounds","getFault","direction","intSuffix","parseInt","slice","newSuffix","pad","newPhoto","getPhoto","url","options","method","credentials","headers","stringify","success","remove","render","userInput","value","key","passwordInput","result","set","expires","buildProjects","prj","description","date","latitude","longitude","menu","id","addMarkers","title","code","addCentrelines","Math","random","toString","substr","attribute","Navbar","bg","expand","Brand","href","src","height","className","Nav","NavDropdown","p","loadLayer","onClick","Item","drop","Divider","loadCentreline","clickTerms","clickContact","documentation","clickAbout","Link","Map","ref","worldCopyJump","boxZoom","center","onZoom","TileLayer","attribution","ScaleControl","Image","toogleMap","thumbnail","LayersControl","Overlay","checked","name","LayerGroup","latlngs","Polyline","weight","color","getColor","smoothFactor","positions","Marker","draggable","clickMarker","Popup","clickImage","Modal","centered","Header","Title","Body","Footer","Button","variant","type","clickClose","Form","Group","controlId","Label","Control","placeholder","clickPrev","clickNext","React","Component","isLocalhost","Boolean","window","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","error","ReactDOM","document","getElementById","URL","process","origin","addEventListener","contentType","indexOf","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.d93f3b89.chunk.js","sourcesContent":["import React from 'react';\r\nimport { Map, TileLayer, Marker, Polyline, Popup, ScaleControl, LayersControl, LayerGroup}  from 'react-leaflet';\r\nimport {Navbar, Nav, NavDropdown, Modal, Button, Image, Form}  from 'react-bootstrap';\r\nimport L from 'leaflet';\r\nimport './App.css';\r\nimport Cookies from 'js-cookie';\r\n\r\nclass App extends React.Component {\r\n\r\n  constructor(props) {\r\n    \r\n    //const osmURL = \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\";\r\n    //const mapBoxURL = \"//api.mapbox.com/styles/v1/mapbox/satellite-streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWp3eW55YXJkIiwiYSI6ImNrM3Q5cDB5ZDAwbG0zZW82enhnamFoN3cifQ.6tHRp0DztZanCDTnEuZJlg\";\r\n    super(props);\r\n    const user = this.getUser();\r\n    const loginModal = this.getLoginModal(user);\r\n    const projects =  this.getProjects();\r\n    \r\n\r\n    this.state = {\r\n      location: {\r\n        lat: -41.2728,\r\n        lng: 173.2995,\r\n      },\r\n      token: Cookies.get('token'),\r\n      login: user,\r\n      loginModal: loginModal,\r\n      zIndex: 900,\r\n      //tileServer: \"//api.mapbox.com/styles/v1/mapbox/satellite-streets-v11/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWp3eW55YXJkIiwiYSI6ImNrM3Q5cDB5ZDAwbG0zZW82enhnamFoN3cifQ.6tHRp0DztZanCDTnEuZJlg\",\r\n      osmThumbnail: \"satellite64.png\",\r\n      mode: \"map\",\r\n      zoom: 8,\r\n      index: null,\r\n      markersData: [],\r\n      centreData: [],\r\n      objData: [],\r\n      fault: [],\r\n      priority: [],\r\n      sizes: [],\r\n      photos: [],\r\n      currentPhoto: null,\r\n      currentFault: [],\r\n      layers: [],\r\n      bounds: {},\r\n      icon: this.getCustomIcon(),\r\n      show: false,\r\n      showLogin: false,\r\n      showContact: false,\r\n      showTerms: false,\r\n      showAbout: false,\r\n      modalPhoto: null,\r\n      popover: false,\r\n      photourl: null,\r\n      amazon: \"https:/taranaki.s3.ap-southeast-2.amazonaws.com/Roads/2019_11/\",\r\n      user: null,\r\n      passowrd: null,\r\n      projectArr: projects\r\n    };\r\n    \r\n  }\r\n\r\n \r\n\r\n  getProjects() {\r\n    let cookie = Cookies.get('projects');\r\n    if (cookie === undefined) {\r\n      return [];\r\n    } else {\r\n      return JSON.parse(cookie);\r\n    }    \r\n  }\r\n  /**\r\n   * Checks if user has cookie. If not not logged in.\r\n   * Returns username in cookie if found else 'Login'\r\n   */\r\n  getUser() {\r\n    const cookie = Cookies.get('user');\r\n    if (cookie === undefined) {\r\n      return \"Login\";\r\n    } else {\r\n      return cookie;\r\n    }    \r\n  }\r\n\r\n  getLoginModal(user) {\r\n    if (user === \"Login\") {\r\n      return (e) => this.clickLogin(e);\r\n    } else {\r\n      return (e) => this.logout(e);\r\n    }\r\n  }\r\n\r\n  getCustomIcon(data, zoom) {\r\n    //console.log(\"data\" + data);\r\n    let icon = null;\r\n    const size = this.getSize(zoom);\r\n    if (data === \"5\") {\r\n      icon = L.icon({\r\n      iconUrl: 'CameraSpringGreen_16px.png',\r\n      iconSize: [size, size],\r\n      iconAnchor: [size / 2, size / 2],\r\n      });\r\n    } else if (data === \"4\") {\r\n      icon = L.icon({\r\n      iconUrl: 'CameraOrange_16px.png',\r\n      iconSize: [size, size],\r\n      iconAnchor: [size / 2, size / 2],\r\n      });      \r\n    } else if (data === \"3\") {\r\n      icon = L.icon({\r\n      iconUrl: 'CameraLemon_16px.png',\r\n      iconSize: [size, size],\r\n      iconAnchor: [size / 2, size / 2],\r\n      });\r\n    } else  {\r\n      icon = L.icon({\r\n      iconUrl: 'CameraSpringGreen_16px.png',\r\n      iconSize: [size, size],\r\n      iconAnchor: [size / 2, size / 2],\r\n      });\r\n    }  \r\n    return icon;\r\n  }\r\n\r\n  getSize(zoom) {\r\n    if (zoom < 10) {\r\n      return 4;\r\n    } else if (zoom >= 10 && zoom <= 14) {\r\n      return 10;\r\n    } else if (zoom > 14 && zoom <= 16) {\r\n      return 16;\r\n    } else if  (zoom > 16 && zoom <= 18){\r\n      return 20;\r\n    } else {\r\n      return 32;\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    // Call our fetch function below once the component mounts\r\n    this.callBackendAPI()\r\n    .catch(err => console.log(err));\r\n    this.map = this.map.leafletElement;\r\n  }\r\n\r\n\r\n  componentDidUpdate() {   \r\n    //let marker = CustomMarker();\r\n  }\r\n\r\n\r\n\r\n  callBackendAPI = async () => {\r\n    const response = await fetch('http://osmium.nz/api') \r\n    const body = await response.json();\r\n    console.log(body.express)\r\n    if (response.status !== 200) {\r\n      throw Error(body.message) \r\n    }\r\n    return body;\r\n  };\r\n\r\n  /*  Adds db data to various arrays and an object. Then sets state to point to arrays. \r\n  */\r\n  async addMarkers(data) {\r\n    let markersData = [];\r\n    let objData = [];\r\n    let faults = [];\r\n    let photos = [];\r\n    let priorities = [];\r\n    let size = [];\r\n    for (var i = 0; i < data.length; i++) {\r\n      let obj = {};\r\n      obj = {\r\n        gid: data[i].gid,\r\n        roadid: data[i].roadid,\r\n        carriage: data[i].carriagewa,\r\n        location: data[i].location,\r\n        fault: data[i].fault,\r\n        size: data[i].size,\r\n        priority: data[i].priority,\r\n        photo: data[i].photoid,\r\n        datetime: data[i].faulttime\r\n      };\r\n      faults.push(data[i].fault);\r\n      photos.push(data[i].photoid);\r\n      objData.push(obj);\r\n      priorities.push(data[i].priority);\r\n      const position = JSON.parse(data[i].st_asgeojson);\r\n      const lng = position.coordinates[0];\r\n      const lat = position.coordinates[1];\r\n      let latlng = L.latLng(lat, lng);\r\n      markersData.push(latlng);     \r\n    }\r\n    //this.setState({index: 0});\r\n    this.setState({objData: objData});\r\n    this.setState({markersData: markersData});\r\n    //this.setState({photos: photos});\r\n    //this.setState({sizes: size});\r\n    //this.setState({priority: priorities});\r\n    \r\n  }\r\n\r\n  addCentrelines(data) {\r\n    let lineData = [];\r\n    console.log(data.length);\r\n    for (var i = 0; i < data.length; i++) {\r\n      const linestring = JSON.parse(data[i].st_asgeojson); \r\n      //console.log(linestring);   \r\n      if(linestring !== null) {\r\n        var points = [];\r\n        //console.log(\"new segment\");\r\n        var segment = linestring.coordinates[0];\r\n        for (var j = 0; j < segment.length; j++) {\r\n          var point = segment[j];\r\n          let latlng = L.latLng(point[1], point[0]);\r\n          points.push(latlng);\r\n        }     \r\n      }\r\n      lineData.push(points);\r\n    }\r\n    let polylines  = [];\r\n    console.log(lineData);\r\n    this.setState({centreData: lineData});\r\n  }\r\n\r\n  /**\r\n   * \r\n   * @param {the number to pad} n \r\n   * @param {the amount of pading} width \r\n   * @param {digit to pad out number with (default '0'} z \r\n   * @return {the padded number (string)}\r\n   */\r\n  pad(n, width, z) {\r\n    z = z || '0';\r\n    n = n + '';\r\n    return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;\r\n    }\r\n\r\n  //EVENTS\r\n  /**\r\n   * fires when user scrolls mousewheel\r\n   * param - e the mouse event\r\n   **/\r\n  onZoom(e) {\r\n    this.setState({zoom: e.target.getZoom()});\r\n    this.setState({bounds: e.target.getBounds()});\r\n  }\r\n\r\n  /**\r\n   * toogles between satellite and map view by swapping z-index\r\n   * @param {the control} e \r\n   */\r\n  toogleMap(e) {\r\n    if (this.state.mode === \"map\") {\r\n      this.setState({zIndex: 1000});\r\n      this.setState({mode: \"sat\"});\r\n      this.setState({osmThumbnail: \"map64.png\"});\r\n    } else {\r\n      this.setState({zIndex: 900});\r\n      this.setState({mode: \"map\"});\r\n      this.setState({osmThumbnail: \"satellite64.png\"})\r\n    }\r\n  }\r\n\r\n  clickImage(e) {    \r\n    console.log('click imge')\r\n    this.setState({show: true});\r\n    let photo = this.getFault(this.state.index, 'photo');\r\n    this.setState({currentPhoto: photo});\r\n  }\r\n\r\n  getPhoto(direction) {\r\n    let photo = this.state.currentPhoto;\r\n    //let photo = this.getFault(this.state.index, 'photo');\r\n    //let suffix = photo.slice(photo.length - 5, photo.length);\r\n    let intSuffix = (parseInt(photo.slice(photo.length - 5, photo.length)));\r\n    let n = null;\r\n    if (direction === \"prev\") {\r\n      n = intSuffix - 1;\r\n    } else {\r\n      n = intSuffix + 1;\r\n    }\r\n    let newSuffix = this.pad(n, 5);\r\n    let prefix = photo.slice(0, photo.length - 5);\r\n    let newPhoto = prefix + newSuffix;\r\n    this.setState({currentPhoto: newPhoto});\r\n    return newPhoto;\r\n  }\r\n\r\n  clickPrev(e) {\r\n  const newPhoto = this.getPhoto(\"prev\");\r\n  console.log(newPhoto);\r\n  this.setState({currentPhoto: newPhoto});\r\n\tconst url = this.state.amazon + newPhoto + \".jpg\";\r\n  this.setState({photourl: url});\r\n  }\r\n  \r\n  clickNext(e) {\r\n  const newPhoto = this.getPhoto(\"next\");\r\n  this.setState({currentPhoto: newPhoto});\r\n  const url = this.state.amazon + newPhoto + \".jpg\";\r\n\tthis.setState({photourl: url});\r\n  }\r\n\r\n  clickMarker(e) {\r\n    let marker = e.target;\r\n    const index = marker.options.index;\r\n    this.setState({index: index});\r\n    this.setState({popover: true});\r\n  }\r\n\r\n  async logout(e) {\r\n    //console.log(\"logout\");\r\n    console.log(this.state.login);\r\n    const response = await fetch('http://osmium.nz/logout', {\r\n      method: 'POST',\r\n      credentials: 'same-origin',\r\n      headers: {\r\n        \"authorization\": this.state.token,\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json',        \r\n      },\r\n      body: JSON.stringify({\r\n        user: this.state.login,\r\n      })\r\n    });\r\n    const body = await response.json();\r\n    if (response.status !== 200) {\r\n      throw Error(body.message) \r\n    } \r\n    \r\n    console.log(body.success);\r\n    this.setState({login: \"Login\"});\r\n    this.setState({loginModal: (e) => this.clickLogin(e)});\r\n    Cookies.remove('token');\r\n    Cookies.remove('user');\r\n    Cookies.remove('projects');\r\n    this.setState({projectArr: []});\r\n    console.log(\"ProjectArr: \" + this.state.projectArr);\r\n    this.render();\r\n  }\r\n\r\n  async login(e) {\r\n    this.setState({showLogin: false});\r\n    const response = await fetch('http://osmium.nz/login', {\r\n      method: 'POST',\r\n      credentials: 'same-origin',\r\n      headers: {\r\n        \"authorization\": this.state.token,\r\n        'Accept': 'application/json',\r\n        'Content-Type': 'application/json',\r\n        \r\n      },\r\n      body: JSON.stringify({\r\n        user: this.userInput.value,\r\n        key: this.passwordInput.value\r\n      })\r\n    });\r\n    const body = await response.json();\r\n    if (response.status !== 200) {\r\n      throw Error(body.message) \r\n    } \r\n    \r\n    if (body.result) {\r\n      console.log(\"Login succeded\");\r\n      Cookies.set('token', body.token, { expires: 7 })\r\n      Cookies.set('user', body.user, { expires: 7 })\r\n      this.setState({login: body.user});\r\n      this.setState({token: body.token});\r\n      this.setState({loginModal: (e) => this.logout(e)});      \r\n      this.buildProjects(body.projects);\r\n      \r\n    } else {\r\n      console.log(\"Login failed\");\r\n    }  \r\n  }\r\n\r\n  buildProjects(projects) {\r\n    let prj = []\r\n    for(var i = 0; i < projects.length; i += 1) {\r\n      prj.push(projects[i].description + \" \" + projects[i].date);\r\n    }\r\n    Cookies.set('projects', JSON.stringify(prj), { expires: 7 })\r\n    this.setState({projectArr: prj});\r\n  }\r\n\r\n  async loadLayer(e) {\r\n    console.log(\"token: \" + this.state.token);\r\n    if (this.state.login !== \"Login\") {\r\n        const response = await fetch('http://osmium.nz/layer', {\r\n        method: 'POST',\r\n        headers: {\r\n          \"authorization\": this.state.token,\r\n          'Accept': 'application/json',\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          latitude: this.state.location.lat,\r\n          longitude: this.state.location.lng,\r\n          menu: e.target.id,\r\n          user: this.state.login\r\n        })\r\n      })\r\n      if (response.status !== 200) {\r\n        console.log(response.status);\r\n      } \r\n      const body = await response.json();\r\n      await this.addMarkers(body);\r\n    } else {\r\n      \r\n    }    \r\n  }\r\n\r\n  async loadCentreline(e) {\r\n    console.log(e.target.title);\r\n    if (this.state.login !== \"Login\") {\r\n        const response = await fetch('http://osmium.nz/roads', {\r\n        method: 'POST',\r\n        headers: {\r\n          \"authorization\": this.state.token,\r\n          'Accept': 'application/json',\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          code: \"900\",\r\n          menu: e.target.id,\r\n          user: this.state.login\r\n        })\r\n      })\r\n      if (response.status !== 200) {\r\n        console.log(response.status);\r\n      } \r\n      const body = await response.json();\r\n      //console.log(body);\r\n      await this.addCentrelines(body);\r\n    } else {\r\n      \r\n    }    \r\n  }\r\n\r\n  clickLogin(e) {\r\n    this.setState({showLogin: true});   \r\n  }\r\n\r\n  clickAbout(e) {\r\n    this.setState({showAbout: true});  \r\n  }\r\n\r\n  clickTerms(e) {\r\n    this.setState({showTerms: true});  \r\n  }\r\n\r\n  clickContact(e) {\r\n    this.setState({showContact: true});  \r\n  }\r\n\r\n  clickClose(e) {\r\n    this.setState({showContact: false});\r\n    this.setState({showAbout: false});    \r\n    this.setState({showTerms: false});    \r\n  }\r\n  /**\r\n   * called when photoviewer closed\r\n   */\r\n  closeModal() {\r\n    this.setState({show: false});\r\n    this.setState({popover: false});\r\n  }\r\n\r\n  getColor() {\r\n    //console.log(\"Hello\");\r\n    return '#' +  Math.random().toString(16).substr(-6);\r\n  }\r\n/**\r\n * gets the requested attribute from the fault object array\r\n * @param {the index of marker} index \r\n * @param {the property of the fault} attribute \r\n */\r\n  getFault(index, attribute) {\r\n    if (this.state.objData.length !== 0 && index !== null) {\r\n      switch(attribute) {\r\n        case \"fault\":\r\n          return  this.state.objData[index].fault;\r\n        case \"priority\":\r\n          //console.log(this.state.objData[index].priority);\r\n          return  this.state.objData[index].priority;\r\n        case \"location\":\r\n        return  this.state.objData[index].location;\r\n        case \"size\":\r\n        return  this.state.objData[index].size;\r\n        case \"datetime\":\r\n          return  this.state.objData[index].datetime;\r\n        case \"photo\":\r\n        return  this.state.objData[index].photo;\r\n        default:\r\n          return null;\r\n      }\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n  //RENDER\r\n\r\n  render() {\r\n    console.log(\"render\");\r\n    const position = [this.state.location.lat, this.state.location.lng];\r\n    const latlngs = this.state.centreData;\r\n    const { markersData } = this.state.markersData;\r\n    const { fault } = this.state.fault;\r\n    const { photo } = this.state.photos;      \r\n    const handleClose = () => this.setState({show: false});\r\n    const priority = null;\r\n\r\n    const CustomTile = function CustomTile (props) {\r\n        return (\r\n            <TileLayer className=\"mapLayer\"\r\n            attribution=\"&amp;copy <a href=&quot;http://osm.org/copyright&quot;>OpenStreetMap</a> contributors and Chat location by Iconika from the Noun Project\"\r\n            url={\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"}\r\n          />\r\n      );\r\n    }\r\n    const CustomNav = function customNav(props) {\r\n      \r\n      if (props.title === 'Login') {\r\n        return (<Nav className=\"ml-auto\">\r\n        <Nav.Link  id=\"Login\" href=\"#login\" onClick={props.onClick}>{props.title} </Nav.Link>\r\n      </Nav>);\r\n      } else {\r\n        return(<Nav className=\"ml-auto\"><NavDropdown className=\"navdropdown\" title={props.title} id=\"basic-nav-dropdown\">\r\n        <NavDropdown.Item className=\"navdropdownitem\" href=\"#contact\"  onClick={props.onClick}>Logout</NavDropdown.Item>\r\n      </NavDropdown></Nav>);\r\n      }\r\n    }\r\n\r\n    const CustomMenu = function(props) {\r\n      const p = props.projects;\r\n      const loadLayer = props.onClick;\r\n      if (p === undefined) {\r\n        console.log(\"Projects\" + p);\r\n        return ( \r\n \r\n          <NavDropdown.Item title=\" Add Layers\" className=\"dropdownitem\">Add Layers\r\n          </NavDropdown.Item>\r\n          );\r\n        } else if(p.length === 0) {\r\n          return ( \r\n \r\n            <NavDropdown.Item title=\" Add Layers\" className=\"dropdownitem\">Add Layers\r\n            </NavDropdown.Item>\r\n            );\r\n    \r\n      } else {  \r\n      return (        \r\n        <NavDropdown title=\" Add Layers\" className=\"navdropdownitem\" drop=\"right\">\r\n        {props.projects.map((value, index) =>      \r\n        <NavDropdown.Item className=\"navdropdownitem\"\r\n        key={`${index}`}\r\n        index={index}\r\n        title={value} onClick={(e) => loadLayer(e)}>\r\n          {value}\r\n        </NavDropdown.Item>)}\r\n        <NavDropdown.Divider />\r\n        </NavDropdown>\r\n        );\r\n      }\r\n    }\r\n\r\n    return (\r\n      <>     \r\n        <div>\r\n          <Navbar bg=\"light\" expand=\"lg\"> \r\n            <Navbar.Brand href=\"#home\">\r\n            <img\r\n                src=\"logo.png\"\r\n                width=\"122\"\r\n                height=\"58\"\r\n                className=\"d-inline-block align-top\"\r\n              />\r\n              </Navbar.Brand>\r\n            <Nav>          \r\n              <NavDropdown className=\"navdropdown\" title=\"Layers\" id=\"basic-nav-dropdown\">\r\n              <CustomMenu projects={this.state.projectArr} onClick={(e) => this.loadLayer(e)}/>\r\n                <NavDropdown.Divider />\r\n                <NavDropdown.Item className=\"navdropdownitem\" href=\"#action/3.4\" onClick={(e) => this.loadCentreline(e)}>Add centreline </NavDropdown.Item>\r\n                <NavDropdown.Divider />\r\n                <NavDropdown.Item className=\"navdropdownitem\" href=\"#action/3.4\">Remove layer</NavDropdown.Item>\r\n              </NavDropdown>\r\n            </Nav>\r\n            <Nav>\r\n              <NavDropdown className=\"navdropdown\" title=\"Help\" id=\"basic-nav-dropdown\">\r\n                <NavDropdown.Item className=\"navdropdownitem\" href=\"#terms\" onClick={(e) => this.clickTerms(e)} >Terms of Use</NavDropdown.Item>\r\n                <NavDropdown.Divider />\r\n                <NavDropdown.Item className=\"navdropdownitem\" href=\"#contact\" onClick={(e) => this.clickContact(e)} >Contact</NavDropdown.Item>\r\n                <NavDropdown.Divider />\r\n                <NavDropdown.Item className=\"navdropdownitem\" id=\"Documentation\" href=\"#documentation\" onClick={(e) => this.documentation(e)}>Documentation</NavDropdown.Item>\r\n                <NavDropdown.Divider />\r\n                <NavDropdown.Item className=\"navdropdownitem\" href=\"#about\" onClick={(e) => this.clickAbout(e)} >About</NavDropdown.Item>             \r\n              </NavDropdown>         \r\n            </Nav>\r\n            <CustomNav className=\"navdropdown\" title={this.state.login} onClick={this.state.loginModal} />\r\n          </Navbar>         \r\n        </div>      \r\n        <div className=\"map\">\r\n        <Map       \r\n          ref={(ref) => { this.map = ref; }}\r\n          className=\"map\"\r\n          fault={fault}\r\n          photo={photo}\r\n          worldCopyJump={true}\r\n          boxZoom={true}\r\n          center={position}\r\n          zoom={this.state.zoom}\r\n          onZoom={(e) => this.onZoom(e)}>\r\n          <TileLayer className=\"mapLayer\"\r\n            attribution=\"&amp;copy <a href=&quot;http://osm.org/copyright&quot;>OpenStreetMap</a> contributors and Chat location by Iconika from the Noun Project\"\r\n            url={\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"}\r\n            zIndex={999}\r\n          />\r\n          <ScaleControl/>\r\n          <Image className=\"satellite\" src={this.state.osmThumbnail} onClick={(e) => this.toogleMap(e)} thumbnail={true}/>\r\n          <LayersControl position=\"topright\">\r\n          <LayersControl.Overlay checked name=\"state highway\">\r\n          <LayerGroup>\r\n          {this.state.centreData.map((latlngs, index) => \r\n          <Polyline \r\n            key={`${index}`}\r\n            weight={3}\r\n            //color={'blue'} \r\n            color={this.getColor()}\r\n            smoothFactor={3}\r\n            positions={latlngs}>\r\n          </Polyline>\r\n          )}\r\n          </LayerGroup>\r\n          </LayersControl.Overlay>\r\n           <LayersControl.Overlay checked name=\"first layer\">\r\n          <LayerGroup>\r\n          {this.state.markersData.map((position, index) => \r\n          \r\n          <Marker \r\n            key={`${index}`}\r\n            index={index}\r\n            data={fault}\r\n            photo={photo}\r\n            position={position} \r\n            icon={this.getCustomIcon(this.getFault(index, 'priority'), this.state.zoom)}\r\n            draggable={false} \r\n            onClick={(e) => this.clickMarker(e)}\t\t\t\t  \r\n            >\r\n\r\n            <Popup className=\"popup\">\r\n            <div>\r\n              <p className=\"faulttext\">\r\n                <b>{\"Type: \"}</b> {this.getFault(index, 'fault')} <br></br> <b>{\"Priority: \"} </b> {this.getFault(index, 'priority')} <br></br><b>{\"Location: \"} </b> {this.getFault(index, 'location')}\r\n              </p>\r\n              <div>\r\n              <Image className=\"thumbnail\" src={this.state.amazon + this.getFault(index, 'photo') + \".jpg\"} photo={photo} onClick={(e) => this.clickImage(e)} thumbnail={true}></Image >\r\n              </div>          \r\n            </div>\r\n            </Popup>  \r\n          </Marker>\r\n      )}     \r\n      </LayerGroup>\r\n</LayersControl.Overlay>\r\n          </LayersControl>\r\n          \r\n      </Map>   \r\n      </div>\r\n      <Modal className=\"termsModal\" show={this.state.showTerms} size={'md'} centered={true}>\r\n        <Modal.Header>\r\n          <Modal.Title><h2>Road Inspection Viewer</h2></Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body >\t\r\n          By using this software you confirm you have read and agreed to the Onsite Developments Ltd. <a href={\"https://osmium.nz/?#terms\"}> Click for terms of use.</a><br></br>\r\n          All data on this site from Land Information New Zealand is made available under a Creative Commons Attribution Licence.<br></br>\r\n          <span >&copy; 2019 Onsite Developments Ltd. All rights reserved.</span><br></br>\r\n\t\t    </Modal.Body>\r\n        <Modal.Footer>\r\n          <Button variant=\"primary\" type=\"submit\" onClick={(e) => this.clickClose(e)}>\r\n              Close\r\n          </Button>\r\n        </Modal.Footer>\r\n      </Modal>\r\n      <Modal className=\"aboutModal\" show={this.state.showAbout} size={'md'} centered={true}>\r\n        <Modal.Header>\r\n          <Modal.Title><h2>About</h2> </Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body >\t\r\n          <b>Road Inspection Version 1.0</b><br></br>\r\n          Relased: 12/01/2020<br></br>\r\n          Company: Onsite Developments Ltd.<br></br>\r\n          Software Developer: Matt Wynyard <br></br>\r\n          <img src=\"logo192.png\" width=\"24\" height=\"24\"/> React: 16.12.0<br></br>\r\n          <img src=\"bootstrap.png\" width=\"24\" height=\"24\"/> Bootstrap: 4.4.0<br></br>\r\n          <img src=\"leafletlogo.png\" width=\"60\" height=\"16\"/>Leaflet: 1.6.0<br></br>\r\n          <img src=\"reactbootstrap.png\" width=\"24\" height=\"24\"/>React-bootstrap: 1.0.0-beta.16<br></br>\r\n          React-leaflet: 2.6.0<br></br>\r\n\t\t    </Modal.Body>\r\n        <Modal.Footer>\r\n          <Button variant=\"primary\" size='sm' type=\"submit\" onClick={(e) => this.clickClose(e)}>\r\n            Close\r\n          </Button>\r\n        </Modal.Footer>\r\n      </Modal>\r\n      <Modal show={this.state.showLogin} size={'sm'} centered={true}>\r\n        <Modal.Header>\r\n          <Modal.Title><img src=\"padlock.png\" width=\"42\" height=\"42\"/> Login </Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body >\t\r\n        <Form>\r\n          <Form.Group controlId=\"userName\">\r\n            <Form.Label>Username</Form.Label>\r\n            <Form.Control type=\"text\" placeholder=\"Enter username\" ref={user => this.userInput = user} />\r\n          </Form.Group>\r\n\r\n          <Form.Group controlId=\"formBasicPassword\">\r\n            <Form.Label>Password</Form.Label>\r\n            <Form.Control type=\"password\" placeholder=\"Password\" ref={key=> this.passwordInput = key}/>\r\n          </Form.Group>\r\n          <Button variant=\"primary\" type=\"submit\" onClick={(e) => this.login(e)}>\r\n            Submit\r\n          </Button>\r\n        </Form>\t\r\n\t\t    </Modal.Body>\r\n        <Modal.Footer>\r\n        </Modal.Footer>\r\n      </Modal>\r\n      \r\n      <Modal show={this.state.show} size={'xl'} >\r\n        <Modal.Body className=\"photoBody\">\t\r\n        <div className=\"container\">\r\n              <div className=\"row\">\r\n              <div className=\"col-md-6\">\r\n                  <b>{\"Type: \"}</b> {this.getFault(this.state.index, 'fault')} <br></br> <b>{\"Priority: \"} </b> {this.getFault(this.state.index, 'priority')} <br></br><b>{\"Location: \"} </b> {this.getFault(this.state.index, 'priority')}\r\n              </div>\r\n              <div className=\"col-md-6\">\r\n                <b>{\"Size: \"}</b> {this.getFault(this.state.index, 'size')} <br></br> <b>{\"DateTime: \"} </b> {this.getFault(this.state.index, 'datetime')}\r\n              </div>\r\n              </div>\r\n            </div>\t\r\n\t\t      <Image className=\"photo\" src={this.state.amazon + this.state.currentPhoto + \".jpg\"} data={fault} onClick={(e) => this.clickImage(e)} thumbnail></Image >\t\t\r\n\t\t    </Modal.Body >\r\n        <Modal.Footer>\r\n\t\t      <Button className=\"prev\" onClick={(e) => this.clickPrev(e)}> \r\n            Previous\r\n          </Button>\r\n          <Button variant=\"primary\" onClick={handleClose}>\r\n            Close\r\n          </Button>\r\n          <Button className=\"next\" variant=\"primary\" onClick={(e) => this.clickNext(e)}>\r\n            Next\r\n          </Button>\r\n        </Modal.Footer>\r\n      </Modal>\r\n      <div className=\"footer\">\r\n      </div>\r\n      </>\r\n    );\r\n  }\r\n}\r\nexport default App;\r\n\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport 'leaflet/dist/leaflet.css';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n//registerServiceWorker();\n"],"sourceRoot":""}